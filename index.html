<!DOCTYPE html>
<head>
  <script>
    !function(n,o){o.forEach(function(o){n[o]||((n.__alloyNS=n.__alloyNS||
    []).push(o),n[o]=function(){var u=arguments;return new Promise(
    function(i,l){n[o].q.push([i,l,u])})},n[o].q=[])})}
    (window,["alloy"]);
  </script>
  <script src="/alloy.min.js" async></script>
</head>
<html>
<body>

  <h1>Hybrid POC</h1>

  <h3>Server rendered personalized content:</h3>
  <button id="serverrendered">{{PERSONALIZED_CONTENT}}</button>

  <h3>Client rendered personalized content:</h3>
  <button><h3 id="clientrendered">Default content</h3></button>

  <script>
    let displayNotificationSent = false;
    const displayXdm = {{DISPLAY_XDM}};
    alloy("configure",{
      orgId: "97D1F3F459CE0AD80A495CBE@AdobeOrg",
      edgeConfigId: "bc58b968-5317-4f56-991c-646ac1a384f6",
      idMigrationEnabled: false,
      thirdPartyCookiesEnabled: false,
      onBeforeEventSend: ({ xdm }) => {
        if (!displayNotificationSent && xdm.eventType === "decisioning.propositionDisplay") {
          xdm._experience.decisioning.propositions.push(
            displayXdm._experience.decisioning.propositions[0]
          );
          displayNotificationSent = true;
        }
      }
    });
    alloy("sendEvent", {
      renderDecisions: true,
      xdm: {
        web: {
          webPageDetails: {
            name: "option3 browser"
          }
        }
      }
    });
    // fail-safe display notification in case the VEC offer never sends a display notification
    setTimeout(() => {
      if (!displayNotificationSent) {
        displayNotificationSent = true;
        alloy("sendEvent", {
          xdm: displayXdm
        });
      }
    }, 2000);

    document.getElementById("serverrendered").addEventListener("click", e => {
      alloy("sendEvent", {
        xdm: {{CLICK_XDM}}
      });
    });
  </script>
</body>
</html>
